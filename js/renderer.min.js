var scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(60,1,1,1e4);camera.position.set(-1e3,540,780),scene.add(camera),window.WebGLRenderingContext||alert("This tool requires WebGL support to run!\nPlease use a newer browser with WebGL (recommended: Chrome or FireFox).");var container=$("#canvas-container"),renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0,preserveDrawingBuffer:!0});function onResize(){renderer.setSize(container.width(),container.height())}container.append(renderer.domElement),$(document).ready(onResize),$(window).resize(onResize);var controls=new THREE.OrbitControls(camera,renderer.domElement);controls.enableDamping=!0,controls.dampingFactor=.25,controls.enableZoom=!0;var loader=new THREE.TextureLoader,ambient_light=new THREE.AmbientLight(14079702);function setAmbientLight(e){ambient_light.color=new THREE.Color(e)}scene.add(ambient_light);var point_light,box_mesh,directional_light=new THREE.DirectionalLight(16777215,.5);function setDirectionalLight(e){directional_light.color=new THREE.Color(e)}function setPointLight(e,r,t){point_light&&camera.remove(point_light),(point_light=new THREE.PointLight(r,t,4500)).position.set(e.x,e.y,e.z),camera.add(point_light)}directional_light.position.set(.5,0,1),scene.add(directional_light),setPointLight({x:100,y:100,z:100},0,1);var back_color,resources=[],textures={};function getTexture(e){var r=product_texture_images["texture-"+e];return texture=loader.load(r.src),texture.generateMipmaps=!1,texture.anisotropy=renderer.getMaxAnisotropy(),texture.magFilter=THREE.LinearFilter,texture.minFilter=THREE.LinearFilter,resources.push(texture),texture}function getMaterial(e){var r=new THREE.MeshPhongMaterial({map:getTexture(e),specular:$("#specular-color")[0].jscolor.toHEXString(),shininess:parseFloat($("#material-shine").val())});return resources.push(r),r}function renderProductBox(){box_mesh&&clearProductBox();var e=parseInt($("#size-x").val()),r=parseInt($("#size-y").val()),t=parseInt($("#size-z").val()),n=new THREE.BoxGeometry(e,r,t,10,10,10);resources.push(n);var o=[getMaterial("right"),getMaterial("left"),getMaterial("top"),getMaterial("top"),getMaterial("front"),getMaterial("back")],a=new THREE.MeshFaceMaterial(o);resources.push(a),box_mesh=new THREE.Mesh(n,a),resources.push(box_mesh),scene.add(box_mesh)}function tryRenderProduct(){try{renderProductBox()}catch(e){setTimeout(tryRenderProduct,100)}}function clearProductBox(){scene.remove(box_mesh);for(var e=0;e<resources.length;++e){var r=resources[e];r.dispose&&r.dispose()}resources=[]}function setBackground(e){back_color=e,$(renderer.domElement).css("background",back_color),renderer.setClearColor(back_color,"none"==back_color?0:1)}tryRenderProduct();var default_background="#FFFFFF";function toImage(){var e=parseInt(document.getElementById("result-img-size-x").value),r=1e3*e/1400;renderer.setSize(e,r),render();var t=renderer.domElement.toDataURL("image/png"),n=document.createElement("a");n.download="generated_image.png",n.href=t,n.click(),onResize(),render()}function render(){if(!isDirectionalLightLocked()){var e=camera.position.clone().normalize();directional_light.position.set(e.x,e.y,e.z)}requestAnimationFrame(render),renderer.render(scene,camera)}setBackground(default_background),requestAnimationFrame=requestAnimationFrame||function(e){setTimeout(e,1e3/60)},render();